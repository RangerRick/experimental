diff -Nurd rubygems-1.3.0/lib/rubygems/defaults.rb rubygems-1.3.0-new/lib/rubygems/defaults.rb
--- rubygems-1.3.0/lib/rubygems/defaults.rb	2008-09-18 20:59:00.000000000 -0400
+++ rubygems-1.3.0-new/lib/rubygems/defaults.rb	2008-09-26 19:08:44.000000000 -0400
@@ -16,8 +16,7 @@
       File.join File.dirname(ConfigMap[:sitedir]), 'Gems',
                 ConfigMap[:ruby_version]
     else
-      File.join(ConfigMap[:libdir], ruby_engine, 'gems',
-                ConfigMap[:ruby_version])
+		File.join('@PREFIX@', 'var', 'lib', 'gems', ConfigMap[:ruby_version])
     end
   end
 
diff -Nurd rubygems-1.3.0/lib/rubygems/source_index.rb rubygems-1.3.0-new/lib/rubygems/source_index.rb
--- rubygems-1.3.0/lib/rubygems/source_index.rb	2008-09-15 19:30:25.000000000 -0400
+++ rubygems-1.3.0-new/lib/rubygems/source_index.rb	2008-09-26 19:06:59.000000000 -0400
@@ -276,7 +276,7 @@
                     end
     else
       version_requirement = platform_only || Gem::Requirement.default
-      gem_pattern = /#{gem_pattern}/i
+      gem_pattern = /^#{gem_pattern}/i
     end
 
     unless Gem::Requirement === version_requirement then
diff -Nurd rubygems-1.3.0/setup.rb rubygems-1.3.0-new/setup.rb
--- rubygems-1.3.0/setup.rb	2008-07-11 04:08:08.000000000 -0400
+++ rubygems-1.3.0-new/setup.rb	2008-09-26 19:13:01.000000000 -0400
@@ -262,7 +262,7 @@
 
 # install RDoc
 
-gem_doc_dir = File.join Gem.dir, 'doc'
+gem_doc_dir = File.join install_destdir, Gem.dir, '/doc'
 rubygems_name = "rubygems-#{Gem::RubyGemsVersion}"
 rubygems_doc_dir = File.join gem_doc_dir, rubygems_name
 
@@ -270,7 +270,7 @@
    (not File.exist? rubygems_doc_dir or
     File.writable? rubygems_doc_dir) then
   puts "Removing old RubyGems RDoc and ri"
-  Dir[File.join(Gem.dir, 'doc', 'rubygems-[0-9]*')].each do |dir|
+  Dir[File.join(gem_doc_dir, 'rubygems-[0-9]*')].each do |dir|
     rm_rf dir
   end
 
