diff -Nurd kdebase-workspace-4.5.3/ConfigureChecks.cmake kdebase-workspace-4.5.3-new/ConfigureChecks.cmake
--- kdebase-workspace-4.5.3/ConfigureChecks.cmake	2010-08-27 04:10:26.000000000 -0400
+++ kdebase-workspace-4.5.3-new/ConfigureChecks.cmake	2010-11-08 18:13:46.000000000 -0500
@@ -3,6 +3,7 @@
 include(FindPkgConfig)
 
 macro_optional_find_package(XKB) # kxkb, kdm
+macro_optional_find_package(Fontconfig)
 
 if (PAM_FOUND)
     set(KDE4_COMMON_PAM_SERVICE "kde" CACHE STRING "The PAM service to use unless overridden for a particular app.")
diff -Nurd kdebase-workspace-4.5.3/kcontrol/CMakeLists.txt kdebase-workspace-4.5.3-new/kcontrol/CMakeLists.txt
--- kdebase-workspace-4.5.3/kcontrol/CMakeLists.txt	2010-05-16 06:04:23.000000000 -0400
+++ kdebase-workspace-4.5.3-new/kcontrol/CMakeLists.txt	2010-11-08 18:13:46.000000000 -0500
@@ -6,9 +6,9 @@
 set(libkxftconfig_SRCS ${CMAKE_CURRENT_SOURCE_DIR}/fonts/kxftconfig.cpp )
 
 
-if( X11_Xrandr_FOUND )
+if( X11_Xrandr_FOUND AND NOT APPLE )
    add_subdirectory( randr )
-endif(X11_Xrandr_FOUND )
+endif(X11_Xrandr_FOUND AND NOT APPLE )
 
 if(X11_Xkb_FOUND)
     add_subdirectory( keyboard )
diff -Nurd kdebase-workspace-4.5.3/kcontrol/input/xcursor/thememodel.cpp kdebase-workspace-4.5.3-new/kcontrol/input/xcursor/thememodel.cpp
--- kdebase-workspace-4.5.3/kcontrol/input/xcursor/thememodel.cpp	2008-08-07 11:21:08.000000000 -0400
+++ kdebase-workspace-4.5.3-new/kcontrol/input/xcursor/thememodel.cpp	2010-11-08 18:13:46.000000000 -0500
@@ -165,7 +165,7 @@
     QString path("~/.icons:/usr/share/icons:/usr/share/pixmaps:/usr/X11R6/lib/X11/icons");
 
     // If XCURSOR_PATH is set, use that instead of the default path
-    char *xcursorPath = std::getenv("XCURSOR_PATH");
+    char *xcursorPath = ::getenv("XCURSOR_PATH");
     if (xcursorPath)
         path = xcursorPath;
 #else
diff -Nurd kdebase-workspace-4.5.3/ksysguard/ksysguardd/CMakeLists.txt kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/CMakeLists.txt
--- kdebase-workspace-4.5.3/ksysguard/ksysguardd/CMakeLists.txt	2009-10-02 10:54:05.000000000 -0400
+++ kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/CMakeLists.txt	2010-11-08 18:13:46.000000000 -0500
@@ -30,8 +30,13 @@
         add_subdirectory( "Solaris" )
         include_directories( ${CMAKE_CURRENT_SOURCE_DIR}/Solaris )
     else( ${CMAKE_SYSTEM_NAME} MATCHES "SunOS" )
-        add_subdirectory( ${CMAKE_SYSTEM_NAME} )
-        include_directories( ${CMAKE_CURRENT_SOURCE_DIR}/${CMAKE_SYSTEM_NAME} )
+        if( IS_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/${CMAKE_SYSTEM_NAME} )
+            add_subdirectory( ${CMAKE_SYSTEM_NAME} )
+            include_directories( ${CMAKE_CURRENT_SOURCE_DIR}/${CMAKE_SYSTEM_NAME} )
+        else( IS_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/${CMAKE_SYSTEM_NAME} )
+            add_subdirectory( "Stub" )
+            include_directories( ${CMAKE_CURRENT_SOURCE_DIR}/"Stub" )
+        endif( IS_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/${CMAKE_SYSTEM_NAME} )
     endif( ${CMAKE_SYSTEM_NAME} MATCHES "SunOS" )
 endif( ${CMAKE_SYSTEM_NAME} MATCHES "DragonFly" )
 endif( ${CMAKE_SYSTEM_NAME} MATCHES "kFreeBSD" )
diff -Nurd kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/CMakeLists.txt kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/CMakeLists.txt
--- kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/CMakeLists.txt	1969-12-31 19:00:00.000000000 -0500
+++ kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/CMakeLists.txt	2010-11-08 18:13:46.000000000 -0500
@@ -0,0 +1,13 @@
+INCLUDE_DIRECTORIES( ${CMAKE_CURRENT_SOURCE_DIR}/../../CContLib ${CMAKE_CURRENT_SOURCE_DIR}/../ )
+
+KDE4_ADD_LIBRARY(libksysguardd STATIC 
+            apm.c
+            CPU.c
+            diskstat.c
+            loadavg.c
+            logfile.c
+            Memory.c
+            netdev.c
+            ProcessList.c)
+
+
diff -Nurd kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/CPU.c kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/CPU.c
--- kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/CPU.c	1969-12-31 19:00:00.000000000 -0500
+++ kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/CPU.c	2010-11-08 18:13:46.000000000 -0500
@@ -0,0 +1,80 @@
+/*
+    KSysGuard, the KDE System Guard
+
+	Copyright (c) 1999 Chris Schlaeger <cs@kde.org>
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+
+*/
+
+#include "CPU.h"
+#include "Command.h"
+#include "ksysguardd.h"
+
+void
+initCpuInfo(struct SensorModul* sm)
+{
+}
+
+void
+exitCpuInfo(void)
+{
+}
+
+int
+updateCpuInfo(void)
+{
+	return 0;
+}
+
+void
+printCPUUser(const char* cmd)
+{
+}
+
+void
+printCPUUserInfo(const char* cmd)
+{
+}
+
+void
+printCPUNice(const char* cmd)
+{
+}
+
+void
+printCPUNiceInfo(const char* cmd)
+{
+}
+
+void
+printCPUSys(const char* cmd)
+{
+}
+
+void
+printCPUSysInfo(const char* cmd)
+{
+}
+
+void
+printCPUIdle(const char* cmd)
+{
+}
+
+void
+printCPUIdleInfo(const char* cmd)
+{
+}
diff -Nurd kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/CPU.h kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/CPU.h
--- kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/CPU.h	1969-12-31 19:00:00.000000000 -0500
+++ kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/CPU.h	2010-11-08 18:13:46.000000000 -0500
@@ -0,0 +1,49 @@
+/*
+    KSysGuard, the KDE System Guard
+   
+	Copyright (c) 1999 Chris Schlaeger <cs@kde.org>
+    
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+
+*/
+
+#ifndef _cpuinfo_h_
+#define _cpuinfo_h_
+
+struct SensorModul;
+
+void initCpuInfo(struct SensorModul* sm);
+void exitCpuInfo(void);
+
+int updateCpuInfo(void);
+
+void printCPUUser(const char* cmd);
+void printCPUUserInfo(const char* cmd);
+void printCPUNice(const char* cmd);
+void printCPUNiceInfo(const char* cmd);
+void printCPUSys(const char* cmd);
+void printCPUSysInfo(const char* cmd);
+void printCPUIdle(const char* cmd);
+void printCPUIdleInfo(const char* cmd);
+void printCPUxUser(const char* cmd);
+void printCPUxUserInfo(const char* cmd);
+void printCPUxNice(const char* cmd);
+void printCPUxNiceInfo(const char* cmd);
+void printCPUxSys(const char* cmd);
+void printCPUxSysInfo(const char* cmd);
+void printCPUxIdle(const char* cmd);
+void printCPUxIdleInfo(const char* cmd);
+
+#endif
diff -Nurd kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/Memory.c kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/Memory.c
--- kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/Memory.c	1969-12-31 19:00:00.000000000 -0500
+++ kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/Memory.c	2010-11-08 18:13:46.000000000 -0500
@@ -0,0 +1,111 @@
+/*
+    KSysGuard, the KDE System Guard
+
+	Copyright (c) 1999-2000 Hans Petter Bieker <bieker@kde.org>
+	Copyright (c) 1999 Chris Schlaeger <cs@kde.org>
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+
+*/
+
+#include "Command.h"
+#include "Memory.h"
+#include "ksysguardd.h"
+
+void
+initMemory(struct SensorModul* sm)
+{
+}
+
+void
+exitMemory(void)
+{
+}
+
+int
+updateMemory(void)
+{
+	return 0;
+}
+
+void
+printMFree(const char* cmd)
+{
+}
+
+void
+printMFreeInfo(const char* cmd)
+{
+}
+
+void
+printUsed(const char* cmd)
+{
+}
+
+void
+printUsedInfo(const char* cmd)
+{
+}
+
+void
+printBuffers(const char* cmd)
+{
+}
+
+void
+printBuffersInfo(const char* cmd)
+{
+}
+
+void
+printCached(const char* cmd)
+{
+}
+
+void
+printCachedInfo(const char* cmd)
+{
+}
+
+void
+printApplication(const char* cmd)
+{
+}
+
+void
+printApplicationInfo(const char* cmd)
+{
+}
+
+void
+printSwapUsed(const char* cmd)
+{
+}
+
+void
+printSwapUsedInfo(const char* cmd)
+{
+}
+
+void
+printSwapFree(const char* cmd)
+{
+}
+
+void
+printSwapFreeInfo(const char* cmd)
+{
+}
diff -Nurd kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/Memory.h kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/Memory.h
--- kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/Memory.h	1969-12-31 19:00:00.000000000 -0500
+++ kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/Memory.h	2010-11-08 18:13:46.000000000 -0500
@@ -0,0 +1,45 @@
+/*
+    KSysGuard, the KDE System Guard
+   
+	Copyright (c) 1999 Chris Schlaeger <cs@kde.org>
+    
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+
+*/
+
+#ifndef _memory_h_
+#define _memory_h_
+
+void initMemory(struct SensorModul* sm);
+void exitMemory(void);
+
+int updateMemory(void);
+
+void printMFree(const char* cmd);
+void printMFreeInfo(const char* cmd);
+void printUsed(const char* cmd);
+void printUsedInfo(const char* cmd);
+void printBuffers(const char* cmd);
+void printBuffersInfo(const char* cmd);
+void printCached(const char* cmd);
+void printCachedInfo(const char* cmd);
+void printApplication(const char* cmd);
+void printApplicationInfo(const char* cmd);
+void printSwapUsed(const char* cmd);
+void printSwapUsedInfo(const char* cmd);
+void printSwapFree(const char* cmd);
+void printSwapFreeInfo(const char* cmd);
+
+#endif
diff -Nurd kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/ProcessList.c kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/ProcessList.c
--- kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/ProcessList.c	1969-12-31 19:00:00.000000000 -0500
+++ kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/ProcessList.c	2010-11-08 18:13:46.000000000 -0500
@@ -0,0 +1,73 @@
+/*
+    KSysGuard, the KDE System Guard
+
+	Copyright (c) 1999-2000 Hans Petter Bieker<bieker@kde.org>
+	Copyright (c) 1999 Chris Schlaeger <cs@kde.org>
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+
+*/
+
+#include "../../gui/SignalIDs.h"
+#include "Command.h"
+#include "ProcessList.h"
+#include "ccont.h"
+#include "ksysguardd.h"
+
+void
+initProcessList(struct SensorModul* sm)
+{
+}
+
+void
+exitProcessList(void)
+{
+}
+
+int
+updateProcessList(void)
+{
+	return 0;
+}
+
+void
+printProcessListInfo(const char* cmd)
+{
+}
+
+void
+printProcessList(const char* cmd)
+{
+}
+
+void
+printProcessCount(const char* cmd)
+{
+}
+
+void
+printProcessCountInfo(const char* cmd)
+{
+}
+
+void
+killProcess(const char* cmd)
+{
+}
+
+void
+setPriority(const char* cmd)
+{
+}
diff -Nurd kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/ProcessList.h kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/ProcessList.h
--- kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/ProcessList.h	1969-12-31 19:00:00.000000000 -0500
+++ kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/ProcessList.h	2010-11-08 18:13:46.000000000 -0500
@@ -0,0 +1,38 @@
+/*
+    KSysGuard, the KDE System Guard
+   
+	Copyright (c) 1999 Chris Schlaeger <cs@kde.org>
+    
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+
+*/
+
+#ifndef _process_list_h_
+#define _process_list_h_
+
+void initProcessList(struct SensorModul* sm);
+void exitProcessList(void);
+
+int updateProcessList(void);
+
+void printProcessList(const char*);
+void printProcessListInfo(const char*);
+void printProcessCount(const char* cmd);
+void printProcessCountInfo(const char* cmd);
+
+void killProcess(const char* cmd);
+void setPriority(const char* cmd);
+
+#endif
diff -Nurd kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/apm.c kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/apm.c
--- kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/apm.c	1969-12-31 19:00:00.000000000 -0500
+++ kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/apm.c	2010-11-08 18:13:46.000000000 -0500
@@ -0,0 +1,58 @@
+/*
+    KSysGuard, the KDE System Guard
+   
+	Copyright (c) 2001 Tobias Koenig <tokoe@kde.org>
+    
+    This program is free software; you can redistribute it and/or
+    modify it under the terms of version 2 of the GNU General Public
+    License as published by the Free Software Foundation.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+
+*/
+
+#include "Command.h"
+#include "apm.h"
+#include "ksysguardd.h"
+
+void
+initApm(struct SensorModul* sm)
+{
+}
+
+void
+exitApm(void)
+{
+}
+
+int
+updateApm(void)
+{
+}
+
+void
+printApmBatFill(const char* c)
+{
+}
+
+void
+printApmBatFillInfo(const char* c)
+{
+}
+
+void
+printApmBatTime(const char* c)
+{
+}
+
+void
+printApmBatTimeInfo(const char* c)
+{
+}
diff -Nurd kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/apm.h kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/apm.h
--- kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/apm.h	1969-12-31 19:00:00.000000000 -0500
+++ kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/apm.h	2010-11-08 18:13:46.000000000 -0500
@@ -0,0 +1,34 @@
+/*
+    KSysGuard, the KDE System Guard
+   
+	Copyright (c) 2001 Tobias Koenig <tokoe@kde.org>
+    
+    This program is free software; you can redistribute it and/or
+    modify it under the terms of version 2 of the GNU General Public
+    License as published by the Free Software Foundation.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+
+*/
+
+#ifndef _apm_h_
+#define _apm_h_
+
+void initApm(struct SensorModul* sm);
+void exitApm(void);
+
+int updateApm(void);
+
+void printApmBatFill(const char*);
+void printApmBatFillInfo(const char*);
+void printApmBatTime(const char*);
+void printApmBatTimeInfo(const char*);
+
+#endif
diff -Nurd kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/diskstat.c kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/diskstat.c
--- kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/diskstat.c	1969-12-31 19:00:00.000000000 -0500
+++ kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/diskstat.c	2010-11-08 18:13:46.000000000 -0500
@@ -0,0 +1,73 @@
+/*
+    KSysGuard, the KDE System Guard
+
+	Copyright (c) 2001 Tobias Koenig <tokoe@kde.org>
+
+    This program is free software; you can redistribute it and/or
+    modify it under the terms of version 2 of the GNU General Public
+    License as published by the Free Software Foundation.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+
+*/
+
+#include "Command.h"
+#include "ccont.h"
+#include "diskstat.h"
+#include "ksysguardd.h"
+
+void initDiskStat(struct SensorModul* sm)
+{
+}
+
+void checkDiskStat(void)
+{
+}
+
+void exitDiskStat(void)
+{
+}
+
+int updateDiskStat(void)
+{
+	return 0;
+}
+
+void printDiskStat(const char* cmd)
+{
+}
+
+void printDiskStatInfo(const char* cmd)
+{
+}
+
+void printDiskStatUsed(const char* cmd)
+{
+}
+
+void printDiskStatUsedInfo(const char* cmd)
+{
+}
+
+void printDiskStatFree(const char* cmd)
+{
+}
+
+void printDiskStatFreeInfo(const char* cmd)
+{
+}
+
+void printDiskStatPercent(const char* cmd)
+{
+}
+
+void printDiskStatPercentInfo(const char* cmd)
+{
+}
diff -Nurd kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/diskstat.h kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/diskstat.h
--- kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/diskstat.h	1969-12-31 19:00:00.000000000 -0500
+++ kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/diskstat.h	2010-11-08 18:13:46.000000000 -0500
@@ -0,0 +1,40 @@
+/*
+    KSysGuard, the KDE System Guard
+	   
+	Copyright (c) 2001 Tobias Koenig <tokoe@kde.org>
+    
+    This program is free software; you can redistribute it and/or
+    modify it under the terms of version 2 of the GNU General Public
+    License as published by the Free Software Foundation.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+
+*/
+
+#ifndef _diskstat_h_
+#define _diskstat_h_
+
+void initDiskStat(struct SensorModul* sm);
+void exitDiskStat(void);
+
+int updateDiskStat(void);
+void checkDiskStat(void);
+
+void printDiskStat(const char* cmd);
+void printDiskStatInfo(const char* cmd);
+
+void printDiskStatUsed(const char* cmd);
+void printDiskStatUsedInfo(const char* cmd);
+void printDiskStatFree(const char* cmd);
+void printDiskStatFreeInfo(const char* cmd);
+void printDiskStatPercent(const char* cmd);
+void printDiskStatPercentInfo(const char* cmd);
+
+#endif
diff -Nurd kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/loadavg.c kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/loadavg.c
--- kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/loadavg.c	1969-12-31 19:00:00.000000000 -0500
+++ kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/loadavg.c	2010-11-08 18:13:46.000000000 -0500
@@ -0,0 +1,69 @@
+/*
+    KSysGuard, the KDE System Guard
+   
+	Copyright (c) 2001 Tobias Koenig <tokoe@kde.org>
+    
+    This program is free software; you can redistribute it and/or
+    modify it under the terms of version 2 of the GNU General Public
+    License as published by the Free Software Foundation.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+
+*/
+
+#include "Command.h"
+#include "ksysguardd.h"
+#include "loadavg.h"
+
+void
+initLoadAvg(struct SensorModul* sm)
+{
+}
+
+void
+exitLoadAvg(void)
+{
+}
+
+int
+updateLoadAvg(void)
+{
+	return 0;
+}
+
+void
+printLoadAvg1(const char* c)
+{
+}
+
+void
+printLoadAvg1Info(const char* c)
+{
+}
+
+void
+printLoadAvg5(const char* c)
+{
+}
+
+void
+printLoadAvg5Info(const char* c)
+{
+}
+
+void
+printLoadAvg15(const char* c)
+{
+}
+
+void
+printLoadAvg15Info(const char* c)
+{
+}
diff -Nurd kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/loadavg.h kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/loadavg.h
--- kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/loadavg.h	1969-12-31 19:00:00.000000000 -0500
+++ kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/loadavg.h	2010-11-08 18:13:46.000000000 -0500
@@ -0,0 +1,36 @@
+/*
+    KSysGuard, the KDE System Guard
+   
+	Copyright (c) 2001 Tobias Koenig <tokoe@kde.org>
+    
+    This program is free software; you can redistribute it and/or
+    modify it under the terms of version 2 of the GNU General Public
+    License as published by the Free Software Foundation.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+
+*/
+
+#ifndef _loadavg_h_
+#define _loadavg_h_
+
+void initLoadAvg(struct SensorModul* sm);
+void exitLoadAvg(void);
+
+int updateLoadAvg(void);
+
+void printLoadAvg1(const char*);
+void printLoadAvg1Info(const char*);
+void printLoadAvg5(const char*);
+void printLoadAvg5Info(const char*);
+void printLoadAvg15(const char*);
+void printLoadAvg15Info(const char*);
+
+#endif
diff -Nurd kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/logfile.c kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/logfile.c
--- kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/logfile.c	1969-12-31 19:00:00.000000000 -0500
+++ kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/logfile.c	2010-11-08 18:13:46.000000000 -0500
@@ -0,0 +1,53 @@
+/*
+    KSysGuard, the KDE System Guard
+   
+	Copyright (c) 2001 Tobias Koenig <tokoe@kde.org>
+    
+    This program is free software; you can redistribute it and/or
+    modify it under the terms of version 2 of the GNU General Public
+    License as published by the Free Software Foundation.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+
+*/
+
+#include "Command.h"
+#include "ccont.h"
+#include "conf.h"
+#include "ksysguardd.h"
+#include "logfile.h"
+
+void initLogFile(struct SensorModul* sm)
+{
+}
+
+void exitLogFile(void)
+{
+}
+
+void printLogFile(const char* cmd)
+{
+}
+
+void printLogFileInfo(const char* cmd)
+{
+}
+
+void registerLogFile(const char* cmd)
+{
+}
+
+void unregisterLogFile(const char* cmd)
+{
+}
+
+void printRegistered(const char* cmd)
+{
+}
diff -Nurd kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/logfile.h kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/logfile.h
--- kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/logfile.h	1969-12-31 19:00:00.000000000 -0500
+++ kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/logfile.h	2010-11-08 18:13:46.000000000 -0500
@@ -0,0 +1,36 @@
+/*
+    KSysGuard, the KDE System Guard
+   
+	Copyright (c) 2001 Tobias Koenig <tokoe@kde.org>
+    
+    This program is free software; you can redistribute it and/or
+    modify it under the terms of version 2 of the GNU General Public
+    License as published by the Free Software Foundation.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+
+*/
+
+#ifndef _logfile_h_
+#define _logfile_h_
+
+void initLogFile(struct SensorModul* sm);
+void exitLogFile(void);
+
+void printLogFile(const char* cmd);
+void printLogFileInfo(const char* cmd);
+
+void registerLogFile(const char* cmd);
+void unregisterLogFile(const char* cmd);
+
+/* debug command */
+void printRegistered(const char* cmd);
+
+#endif
diff -Nurd kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/netdev.c kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/netdev.c
--- kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/netdev.c	1969-12-31 19:00:00.000000000 -0500
+++ kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/netdev.c	2010-11-08 18:13:46.000000000 -0500
@@ -0,0 +1,56 @@
+/*
+    KSysGuard, the KDE System Guard
+   
+	Copyright (c) 2001 Tobias Koenig <tokoe@kde.org>
+    
+    This program is free software; you can redistribute it and/or
+    modify it under the terms of version 2 of the GNU General Public
+    License as published by the Free Software Foundation.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+
+*/
+
+#include "Command.h"
+#include "ksysguardd.h"
+#include "netdev.h"
+
+void initNetDev(struct SensorModul* sm)
+{
+}
+
+void exitNetDev(void)
+{
+}
+
+int updateNetDev(void)
+{
+	return 0;
+}
+
+void checkNetDev(void)
+{
+}
+
+void printNetDevRecBytes(const char *cmd)
+{
+}
+
+void printNetDevRecBytesInfo(const char *cmd)
+{
+}
+
+void printNetDevSentBytes(const char *cmd)
+{
+}
+
+void printNetDevSentBytesInfo(const char *cmd)
+{
+}
diff -Nurd kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/netdev.h kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/netdev.h
--- kdebase-workspace-4.5.3/ksysguard/ksysguardd/Stub/netdev.h	1969-12-31 19:00:00.000000000 -0500
+++ kdebase-workspace-4.5.3-new/ksysguard/ksysguardd/Stub/netdev.h	2010-11-08 18:13:46.000000000 -0500
@@ -0,0 +1,35 @@
+/*
+    KSysGuard, the KDE System Guard
+   
+	Copyright (c) 2001 Tobias Koenig <tokoe@kde.org>
+    
+    This program is free software; you can redistribute it and/or
+    modify it under the terms of version 2 of the GNU General Public
+    License as published by the Free Software Foundation.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+
+*/
+
+#ifndef _netdev_h_
+#define _netdev_h_
+
+void initNetDev(struct SensorModul* sm);
+void exitNetDev(void);
+
+int updateNetDev(void);
+void checkNetDev(void);
+
+void printNetDevRecBytes(const char* cmd);
+void printNetDevRecBytesInfo(const char* cmd);
+void printNetDevSentBytes(const char* cmd);
+void printNetDevSentBytesInfo(const char* cmd);
+
+#endif
diff -Nurd kdebase-workspace-4.5.3/kwin/lib/kwinglutils.cpp kdebase-workspace-4.5.3-new/kwin/lib/kwinglutils.cpp
--- kdebase-workspace-4.5.3/kwin/lib/kwinglutils.cpp	2010-08-27 04:10:24.000000000 -0400
+++ kdebase-workspace-4.5.3-new/kwin/lib/kwinglutils.cpp	2010-11-08 18:23:24.000000000 -0500
@@ -1044,9 +1044,11 @@
         case GL_FRAMEBUFFER_INCOMPLETE_FORMATS_EXT:
             // The color attachments don't have the same format
             return "GL_FRAMEBUFFER_INCOMPLETE_FORMATS_EXT";
+#ifdef GL_FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT
         case GL_FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:
             // The attachments don't have the same number of samples
             return "GL_FRAMEBUFFER_INCOMPLETE_MULTISAMPLE";
+#endif
         case GL_FRAMEBUFFER_INCOMPLETE_DRAW_BUFFER_EXT:
             // The draw buffer is missing
             return "GL_FRAMEBUFFER_INCOMPLETE_DRAW_BUFFER";
diff -Nurd kdebase-workspace-4.5.3/libs/ksysguard/processcore/processes_atop_p.cpp kdebase-workspace-4.5.3-new/libs/ksysguard/processcore/processes_atop_p.cpp
--- kdebase-workspace-4.5.3/libs/ksysguard/processcore/processes_atop_p.cpp	2010-06-24 12:28:14.000000000 -0400
+++ kdebase-workspace-4.5.3-new/libs/ksysguard/processcore/processes_atop_p.cpp	2010-11-08 18:20:12.000000000 -0500
@@ -81,6 +81,11 @@
     return d->loadHistoryFile(filename);
 }
 
+long KSysGuard::ProcessesATop::numberProcessorCores()
+{
+    return 0;
+}
+
 bool ProcessesATop::Private::loadHistoryFile(const QString &filename) {
     atopLog.setFileName(filename);
     ready = false;
diff -Nurd kdebase-workspace-4.5.3/libs/ksysguard/processcore/processes_local_p.cpp kdebase-workspace-4.5.3-new/libs/ksysguard/processcore/processes_local_p.cpp
--- kdebase-workspace-4.5.3/libs/ksysguard/processcore/processes_local_p.cpp	2009-12-14 05:43:38.000000000 -0500
+++ kdebase-workspace-4.5.3-new/libs/ksysguard/processcore/processes_local_p.cpp	2010-11-08 18:20:12.000000000 -0500
@@ -34,6 +34,8 @@
 #include <qglobal.h>
 #ifdef Q_OS_SOLARIS
 #include "processes_solaris_p.cpp"
+#else
+#include "processes_stub_p.cpp"
 #endif
 #endif
 
diff -Nurd kdebase-workspace-4.5.3/libs/ksysguard/processcore/processes_local_p.h kdebase-workspace-4.5.3-new/libs/ksysguard/processcore/processes_local_p.h
--- kdebase-workspace-4.5.3/libs/ksysguard/processcore/processes_local_p.h	2010-02-20 06:31:44.000000000 -0500
+++ kdebase-workspace-4.5.3-new/libs/ksysguard/processcore/processes_local_p.h	2010-11-08 18:20:12.000000000 -0500
@@ -25,7 +25,6 @@
 #include "processes_base_p.h"
 #include <unistd.h>  //For sysconf
 
-
 #include <QSet>
 
 namespace KSysGuard
diff -Nurd kdebase-workspace-4.5.3/libs/ksysguard/processcore/processes_stub_p.cpp kdebase-workspace-4.5.3-new/libs/ksysguard/processcore/processes_stub_p.cpp
--- kdebase-workspace-4.5.3/libs/ksysguard/processcore/processes_stub_p.cpp	1969-12-31 19:00:00.000000000 -0500
+++ kdebase-workspace-4.5.3-new/libs/ksysguard/processcore/processes_stub_p.cpp	2010-11-08 18:20:12.000000000 -0500
@@ -0,0 +1,163 @@
+/*  This file is part of the KDE project
+    Copyright (C) 2007 Manolo Valdes <nolis71cu@gmail.com>
+
+    This library is free software; you can redistribute it and/or
+    modify it under the terms of the GNU Library General Public
+    License version 2 as published by the Free Software Foundation.
+
+    This library is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+    Library General Public License for more details.
+
+    You should have received a copy of the GNU Library General Public License
+    along with this library; see the file COPYING.LIB.  If not, write to
+    the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+    Boston, MA 02110-1301, USA.
+*/
+
+#include "processes_local_p.h"
+#include "process.h"
+
+#include <klocale.h>
+
+#include <QSet>
+
+#include <sys/param.h>
+#include <sys/sysctl.h>
+#include <sys/types.h>
+#include <sys/user.h>
+#include <sys/resource.h>
+#if defined(__DragonFly__)
+#include <sys/resourcevar.h>
+#include <err.h>
+#endif
+#include <signal.h>
+#include <unistd.h>  
+
+
+
+
+namespace KSysGuard
+{
+
+  class ProcessesLocal::Private
+  {
+    public:
+      Private() {;}
+      ~Private() {;}
+      inline bool readProc(long pid, struct kinfo_proc *p);
+      inline void readProcStatus(struct kinfo_proc *p, Process *process);
+      inline void readProcStat(struct kinfo_proc *p, Process *process);
+      inline void readProcStatm(struct kinfo_proc *p, Process *process);
+      inline bool readProcCmdline(long pid, Process *process);
+    };
+
+#ifndef _SC_NPROCESSORS_ONLN
+long int KSysGuard::ProcessesLocal::numberProcessorCores()
+{
+    int mib[2];
+    int ncpu;
+    size_t len;
+
+    mib[0] = CTL_HW;
+    mib[1] = HW_NCPU;
+    len = sizeof(ncpu);
+
+    if (sysctl(mib, 2, &ncpu, &len, NULL, 0) == -1 || !len)
+        return 1;
+    return len;
+}
+#endif  
+
+bool ProcessesLocal::Private::readProc(long pid, struct kinfo_proc *p)
+{
+    return false;
+}
+
+void ProcessesLocal::Private::readProcStatus(struct kinfo_proc *p, Process *process)
+{
+}
+
+void ProcessesLocal::Private::readProcStat(struct kinfo_proc *p, Process *ps)
+{
+}
+
+void ProcessesLocal::Private::readProcStatm(struct kinfo_proc *p, Process *process)
+{
+}
+
+bool ProcessesLocal::Private::readProcCmdline(long pid, Process *process)
+{
+    return false;
+}
+
+ProcessesLocal::ProcessesLocal() : d(new Private())
+{
+}
+
+long ProcessesLocal::getParentPid(long pid) {
+    Q_ASSERT(pid != 0);
+    long long ppid = 0;
+    struct kinfo_proc p;
+    if(d->readProc(pid, &p))
+    {
+#if defined(__FreeBSD__) && __FreeBSD_version >= 500015
+        ppid = p.ki_ppid;
+#elif defined(__DragonFly__) && __DragonFly_version >= 190000
+        ppid = p.kp_ppid;
+#else
+        ppid = p.kp_eproc.e_ppid;
+#endif
+    }
+    return ppid;
+}
+
+bool ProcessesLocal::updateProcessInfo( long pid, Process *process)
+{
+    struct kinfo_proc p;
+    if(!d->readProc(pid, &p)) return false;
+    d->readProcStat(&p, process);
+    d->readProcStatus(&p, process);
+    d->readProcStatm(&p, process);
+    if(!d->readProcCmdline(pid, process)) return false;
+
+    return true;
+}
+
+QSet<long> ProcessesLocal::getAllPids( )
+{
+    QSet<long> pids;
+    return pids;
+}
+
+bool ProcessesLocal::sendSignal(long pid, int sig) {
+    return false;
+}
+
+bool ProcessesLocal::setNiceness(long pid, int priority) {
+    return false;
+}
+
+bool ProcessesLocal::setIoNiceness(long pid, int priorityClass, int priority) {
+    return false;
+}
+
+bool ProcessesLocal::supportsIoNiceness() {
+    return false;
+}
+
+bool ProcessesLocal::setScheduler(long pid, int priorityClass, int priority) 
+{
+    return false;
+}
+
+long long ProcessesLocal::totalPhysicalMemory() {
+    return 0;
+}
+
+ProcessesLocal::~ProcessesLocal()
+{
+}
+
+}
diff -Nurd kdebase-workspace-4.5.3/libs/solid/control/CMakeLists.txt kdebase-workspace-4.5.3-new/libs/solid/control/CMakeLists.txt
--- kdebase-workspace-4.5.3/libs/solid/control/CMakeLists.txt	2010-07-07 13:10:11.000000000 -0400
+++ kdebase-workspace-4.5.3-new/libs/solid/control/CMakeLists.txt	2010-11-08 18:13:46.000000000 -0500
@@ -33,9 +33,9 @@
 )
 
 # FIXME: this should be XRANDR_FOUND instead
-if(NOT WIN32)
+if(NOT WIN32 AND NOT APPLE)
 set(solidcontrol_LIB_SRCS ${solidcontrol_LIB_SRCS} powermanager_randr.cpp)
-endif(NOT WIN32)
+endif(NOT WIN32 AND NOT APPLE)
 
 qt4_add_dbus_interface(solidcontrol_LIB_SRCS org.kde.Solid.Networking.xml org_kde_solid_networking)
 
diff -Nurd kdebase-workspace-4.5.3/libs/solid/control/powermanager.cpp kdebase-workspace-4.5.3-new/libs/solid/control/powermanager.cpp
--- kdebase-workspace-4.5.3/libs/solid/control/powermanager.cpp	2010-05-16 06:04:26.000000000 -0400
+++ kdebase-workspace-4.5.3-new/libs/solid/control/powermanager.cpp	2010-11-08 18:13:46.000000000 -0500
@@ -138,7 +138,7 @@
         Solid::Control::PowerManager::BrightnessControlsList controls = brightnessControlsAvailable();
         if(controls.keys(Solid::Control::PowerManager::Screen).isEmpty())
         {
-#ifdef Q_WS_WIN
+#if defined(Q_WS_WIN) || defined(__APPLE__)
             return false;
 #else
             return ( xrandr_brightlight( QX11Info::display(), brightness ) >= 0 );
@@ -168,7 +168,7 @@
         Solid::Control::PowerManager::BrightnessControlsList controls = brightnessControlsAvailable();
         if(controls.keys(Solid::Control::PowerManager::Screen).isEmpty())
         {
-#ifdef Q_WS_WIN
+#if defined(Q_WS_WIN) || defined(__APPLE__)
             return false;
 #else
             return xrandr_brightlight( QX11Info::display() );
diff -Nurd kdebase-workspace-4.5.3/plasma/desktop/shell/panelview.cpp kdebase-workspace-4.5.3-new/plasma/desktop/shell/panelview.cpp
--- kdebase-workspace-4.5.3/plasma/desktop/shell/panelview.cpp	2010-09-30 17:20:34.000000000 -0400
+++ kdebase-workspace-4.5.3-new/plasma/desktop/shell/panelview.cpp	2010-11-08 18:13:46.000000000 -0500
@@ -46,6 +46,12 @@
 
 #include <kephal/screens.h>
 
+#ifdef __APPLE__
+# ifndef ShapeInput
+#  define ShapeInput 2
+# endif
+#endif
+
 class GlowBar : public QWidget
 {
 public:
diff -Nurd kdebase-workspace-4.5.3/plasma/desktop/shell/plasmaapp.cpp kdebase-workspace-4.5.3-new/plasma/desktop/shell/plasmaapp.cpp
--- kdebase-workspace-4.5.3/plasma/desktop/shell/plasmaapp.cpp	2010-09-30 17:20:34.000000000 -0400
+++ kdebase-workspace-4.5.3-new/plasma/desktop/shell/plasmaapp.cpp	2010-11-08 18:13:46.000000000 -0500
@@ -36,7 +36,7 @@
     #include <sys/sysctl.h>
     #endif
 
-    #ifdef Q_OS_NETBSD
+    #if defined(Q_OS_NETBSD) || defined(Q_OS_DARWIN) || defined(Q_OS_MAC)
     #include <sys/param.h>
     #include <sys/sysctl.h>
     #endif
@@ -200,7 +200,7 @@
         }
     }
 #endif
-#ifdef Q_OS_NETBSD
+#if defined(Q_OS_NETBSD) || defined(Q_OS_DARWIN) || defined(Q_OS_MAC)
     size_t memorySize;
     size_t len;
     static int mib[] = { CTL_HW, HW_PHYSMEM };
diff -Nurd kdebase-workspace-4.5.3/plasma/generic/applets/CMakeLists.txt kdebase-workspace-4.5.3-new/plasma/generic/applets/CMakeLists.txt
--- kdebase-workspace-4.5.3/plasma/generic/applets/CMakeLists.txt	2010-02-20 06:31:50.000000000 -0500
+++ kdebase-workspace-4.5.3-new/plasma/generic/applets/CMakeLists.txt	2010-11-08 18:13:46.000000000 -0500
@@ -13,9 +13,9 @@
    add_subdirectory(webbrowser)
 endif(QT_QTWEBKIT_FOUND)
 
-if(NOT WIN32)
+if(NOT WIN32 AND NOT APPLE)
    add_subdirectory(system-monitor)
    add_subdirectory(systemtray)
    #should compile also on windows? (even if doesn't really make sense)
    add_subdirectory(notifications)
-endif(NOT WIN32)
+endif(NOT WIN32 AND NOT APPLE)
diff -Nurd kdebase-workspace-4.5.3/plasma/generic/dataengines/metadata/CMakeLists.txt kdebase-workspace-4.5.3-new/plasma/generic/dataengines/metadata/CMakeLists.txt
--- kdebase-workspace-4.5.3/plasma/generic/dataengines/metadata/CMakeLists.txt	2009-09-16 07:40:54.000000000 -0400
+++ kdebase-workspace-4.5.3-new/plasma/generic/dataengines/metadata/CMakeLists.txt	2010-11-08 18:13:46.000000000 -0500
@@ -4,6 +4,7 @@
  
 kde4_add_plugin(plasma_engine_metadata ${metadata_engine_SRCS})
 
+include_directories(${SOPRANO_INCLUDE_DIR})
 target_link_libraries(plasma_engine_metadata
 		      ${KDE4_KIO_LIBS}
                       ${KDE4_KDECORE_LIBS}
diff -Nurd kdebase-workspace-4.5.3/plasma/netbook/shell/CMakeLists.txt kdebase-workspace-4.5.3-new/plasma/netbook/shell/CMakeLists.txt
--- kdebase-workspace-4.5.3/plasma/netbook/shell/CMakeLists.txt	2010-07-07 13:10:15.000000000 -0400
+++ kdebase-workspace-4.5.3-new/plasma/netbook/shell/CMakeLists.txt	2010-11-08 18:13:46.000000000 -0500
@@ -1,4 +1,4 @@
-include_directories(${KDEBASE_WORKSPACE_SOURCE_DIR}/libs ${KDEBASE_WORKSPACE_SOURCE_DIR}/libs/plasmagenericshell ${KDEBASE_WORKSPACE_SOURCE_DIR}/plasma/netbook/shell/scripting/ ${KDEBASE_WORKSPACE_SOURCE_DIR}/libs/kephal ${KDEBASE_WORKSPACE_SOURCE_DIR}/libs/kworkspace)
+include_directories(${KDEBASE_WORKSPACE_SOURCE_DIR}/libs ${KDEBASE_WORKSPACE_SOURCE_DIR}/libs/plasmagenericshell ${KDEBASE_WORKSPACE_SOURCE_DIR}/plasma/netbook/shell/scripting/ ${KDEBASE_WORKSPACE_SOURCE_DIR}/libs/kephal ${KDEBASE_WORKSPACE_SOURCE_DIR}/libs/kworkspace ${OPENGL_INCLUDE_DIR})
 
 
 set(plasma-netbook_SRCS
diff -Nurd kdebase-workspace-4.5.3/plasma/netbook/shell/plasmaapp.cpp kdebase-workspace-4.5.3-new/plasma/netbook/shell/plasmaapp.cpp
--- kdebase-workspace-4.5.3/plasma/netbook/shell/plasmaapp.cpp	2010-07-06 02:54:32.000000000 -0400
+++ kdebase-workspace-4.5.3-new/plasma/netbook/shell/plasmaapp.cpp	2010-11-08 18:13:46.000000000 -0500
@@ -57,6 +57,12 @@
 #include <X11/extensions/shape.h>
 #endif
 
+#ifdef __APPLE__
+# ifndef ShapeInput
+#  define ShapeInput 2
+# endif
+#endif
+
 PlasmaApp* PlasmaApp::self()
 {
     if (!kapp) {
diff -Nurd kdebase-workspace-4.5.3/plasma/screensaver/shell/plasmaapp.cpp kdebase-workspace-4.5.3-new/plasma/screensaver/shell/plasmaapp.cpp
--- kdebase-workspace-4.5.3/plasma/screensaver/shell/plasmaapp.cpp	2010-09-30 17:20:21.000000000 -0400
+++ kdebase-workspace-4.5.3-new/plasma/screensaver/shell/plasmaapp.cpp	2010-11-08 18:13:46.000000000 -0500
@@ -33,7 +33,7 @@
     #include <sys/sysctl.h>
     #endif
 
-    #ifdef Q_OS_NETBSD
+    #if defined(Q_OS_NETBSD) || defined(Q_OS_DARWIN) || defined(Q_OS_MAC)
     #include <sys/param.h>
     #include <sys/sysctl.h>
     #endif
@@ -173,7 +173,7 @@
         }
     }
 #endif
-#ifdef Q_OS_NETBSD
+#if defined(Q_OS_NETBSD) || defined(Q_OS_DARWIN) || defined(Q_OS_MAC)
     size_t memorySize;
     size_t len;
     static int mib[] = { CTL_HW, HW_PHYSMEM };
diff -Nurd kdebase-workspace-4.5.3/qguiplatformplugin_kde/CMakeLists.txt kdebase-workspace-4.5.3-new/qguiplatformplugin_kde/CMakeLists.txt
--- kdebase-workspace-4.5.3/qguiplatformplugin_kde/CMakeLists.txt	2009-12-04 18:09:28.000000000 -0500
+++ kdebase-workspace-4.5.3-new/qguiplatformplugin_kde/CMakeLists.txt	2010-11-08 18:13:46.000000000 -0500
@@ -4,7 +4,7 @@
 qt4_generate_moc(qguiplatformplugin_kde.cpp ${CMAKE_CURRENT_BINARY_DIR}/qguiplatformplugin_kde.moc)
 
 
-add_library (kde SHARED ${kde_SOURCES})
+kde4_add_plugin (kde ${kde_SOURCES})
 
 target_link_libraries(kde ${KDE4_KIO_LIBS} ${QT_QTGUI_LIBRARY})
 
diff -Nurd kdebase-workspace-4.5.3/startkde.cmake kdebase-workspace-4.5.3-new/startkde.cmake
--- kdebase-workspace-4.5.3/startkde.cmake	2010-08-27 04:10:26.000000000 -0400
+++ kdebase-workspace-4.5.3-new/startkde.cmake	2010-11-08 18:13:46.000000000 -0500
@@ -13,6 +13,26 @@
 # because we still need to do some cleanup.
 trap 'echo GOT SIGHUP' HUP
 
+unset KDEDIR KDEDIRS
+
+export PATH="@FINKPREFIX@/bin:$PATH"
+
+_XDG_DATA_DIRS=""
+_XDG_CONFIG_DIRS=""
+PREFIXES=`grep '^prefixes=' "@FINKPREFIX@/opt/kde4/@FINKTYPE@/etc/kde4rc" | cut -d= -f2-`
+orig_IFS=$IFS
+IFS=","
+for PRE in $PREFIXES; do
+        export _XDG_DATA_DIRS="$_XDG_DATA_DIRS:$PRE/share"
+        export _XDG_CONFIG_DIRS="$_XDG_CONFIG_DIRS:$PRE/etc/xdg"
+		  export PATH="$PRE/bin:$PATH"
+done
+IFS=$orig_IFS
+
+XDG_DATA_DIRS=`echo $_XDG_DATA_DIRS:$XDG_DATA_DIRS | sed -e 's,^:,,' -e 's,:$,,'`
+XDG_CONFIG_DIRS=`echo $_XDG_CONFIG_DIRS:$XDG_CONFIG_DIRS | sed -e 's,^:,,' -e 's,:$,,'`
+export XDG_DATA_DIRS XDG_CONFIG_DIRS
+
 # Check if a KDE session already is running and whether it's possible to connect to X
 kcheckrunning
 kcheckrunning_result=$?
@@ -52,6 +72,11 @@
   esac
 fi
 
+for DIR in `echo $KDEDIRS | perl -e 'chomp(my $line = <STDIN>); print join(" ", reverse(split(/:/, $line)))'`; do
+	PATH="$DIR/bin:$PATH"
+	export PATH
+done
+
 # Boot sequence:
 #
 # kdeinit is used to fork off processes which improves memory usage
