Package: mesa
Version: 6.5.3
Revision: 1

Maintainer: Murali Vadivelu <murali1080@users.sf.net>

Depends: %N-shlibs (= %v-%r)
BuildDepends: bigreqsproto, inputproto (>= 1.4-1), kbproto, libice, libsm, libx11, libxau, libxdmcp, libxext, libxmu, libxt, makedepend, xcmiscproto, xextproto, xproto, xtrans
BuildDependsOnly: True
GCC: 4.0

Description: 3-D graphics library
Homepage: http://mesa3d.sourceforge.net/
License: OSI-Approved

Source: mirror:sourceforge:mesa3d/MesaLib-%v.tar.bz2
Source2: mirror:sourceforge:mesa3d/MesaGLUT-%v.tar.bz2

SourceDirectory: Mesa-%v
Source-MD5: 46359457147c469745f24b5074a186f0
Source2-MD5: 360843e46b7ebb6909290b023f9b26fa

PatchScript: sed 's,@PREFIX@,/usr/X11,g' < %a/%n.patch | patch -p1

NoSetMAKEFLAGS: true
SetMAKEFLAGS: -j1

CompileScript: <<
make darwin
make realclean
make darwin-static
<<

InstallScript: <<
#!/bin/sh -ev

mkdir -p %d/usr/X11/lib
mv lib/* %d/usr/X11/lib

mkdir -p %d/usr/X11/include
mv include/* %d/usr/X11/include/

# compatibility with old mesa package
mkdir -p %i/lib/%n %i/include/%n
mv %d/usr/X11/lib/libOSMesa* %i/lib/%n/
mv %d/usr/X11/lib/libglut*   %i/lib/%n/
pushd %i/lib/%n
	ln -sf ../../../usr/X11/lib/* .
	install_name_tool -id %p/lib/%n/libOSMesa.6.dylib libOSMesa.6.5.dylib
	install_name_tool -id %p/lib/%n/libglut.3.dylib   libglut.3.7.dylib
popd
pushd %i/include/%n
	ln -sf ../../../usr/X11/include/* .
popd

mkdir -p %i/share/%n
cp -r docs %i/share/%n/
<<

SplitOff: <<
	Package: %N-shlibs
	Depends: libx11-shlibs, libxext-shlibs, libxi-shlibs, libxmu-shlibs
	Files: /usr/X11/lib/lib*.*.dylib lib/mesa/lib*.*.dylib
	Shlibs: <<
		/usr/X11/lib/libGLU.1.dylib   1.3.0 %n (>= 6.5.3-1)
		/usr/X11/lib/libGL.1.dylib    1.5.0 %n (>= 6.5.3-1)
		%p/lib/mesa/libglut.3.dylib   3.7.0 %n (>= 6.5.3-1)
		%p/lib/mesa/libOSMesa.6.dylib 6.5.0 %n (>= 6.5.3-1)
	<<
	DocFiles: docs/COPYING
<<

DocFiles: docs/COPYING

DescDetail: <<
Mesa is a 3-D graphics library with an API which
is very similar to that of OpenGL.* To the extent 
that Mesa utilizes the OpenGL command syntax or 
state machine, it is being used with authorization 
from Silicon Graphics, Inc.(SGI). However, the 
author does not possess an OpenGL license from 
SGI, and makes no claim that Mesa is in any way 
a compatible replacement for OpenGL or associated 
with SGI. Those who want a licensed implementation 
of OpenGL should contact a licensed vendor. 
<<

DescUsage: <<
The OpenGL libraries and headers are installed to
/usr/X11, but the Mesa-specific libraries (libOSMesa
and libglut) are installed to %p/lib/mesa/ for
compatibility with older versions of this package.

To link with Mesa, you will need to make sure your
-I and -L flags explicitly point to %p/lib/mesa
(or /usr/X11).

The order in which the flags are passed to the
linker is also important, so that Mesa libraries is
the one that is seen first by the linker (before the
system OpenGL). 

Care needs to be taken to avoid system OpenGL,
if you want to use Mesa3d, while compiling, like
making sure that its first in the linker's search
path. Otherwise, you may get runtime errors.

ALSO, you only need to set your package to use the
GCC: field if you use libGLU -- the other libraries
are C-only and do not have ABI compat issues.
<<
