Info4: <<
Package: qtwebkit-mac
Version: 2.0.0
Revision: 1
Epoch: 1
Description: Qt browser framework
Type: qtwebkit (mac)
License: LGPL
Maintainer: Benjamin Reed <qtwebkit@fink.raccoonfink.com>

Depends: %N-shlibs (>= %v-%r)
BuildDepends: <<
	fink (>= 0.29.7-1),
	phonon-%type_pkg[qtwebkit],
	system-openssl-dev,
	qt4-base-%type_pkg[qtwebkit] (>= 4.7.3-1)
<<
Replaces: qt4-%type_pkg[qtwebkit] (<< 4.7.3-1)
GCC: 4.0

CustomMirror: <<
	Primary: http://www.finkproject.org/~ranger/distfiles
	eur-NL: http://www.finkproject.org/~ranger/distfiles
	nam-US: http://ranger.befunk.com/fink
<<
Source: mirror:custom:qt/qt-4.7.3-mac-1c3b651.tar.gz
Source-MD5: d1164c0d75d0f4e86c2e61eb4fd50045
SourceDirectory: qt-kde-qt-mac
PatchFile: qtwebkit.patch
PatchFile-MD5: 1f256c5df19107c011d9e8995a8c9721

UseMaxBuildJobs: true
CompileScript: <<
	#!/bin/sh -ev
	
	pushd src/3rdparty/webkit
	%p/lib/qt4-%type_pkg[qtwebkit]/bin/qmake WebKit.pro
	make
	
	# dunno why I need to do this manually, but...
	pushd WebKit/qt/declarative
	if [ -f Makefile.Release ]; then
	make -f Makefile.Release
	else
	make
	fi
	popd
	popd
<<

InstallScript: <<
#!/bin/sh -ev

	pushd src/3rdparty/webkit
		make -j1 install INSTALL_ROOT="%d"
		pushd WebKit/qt/declarative
			if [ -f Makefile.Release ]; then
				make -f Makefile.Release -j1 install INSTALL_ROOT="%d"
			else
				make -j1 install INSTALL_ROOT="%d"
			fi
		popd
	popd

	find %i -name \*.prl -o -name \*.pc -o -name \*.la | xargs perl -pi -e 's,%b/lib,%p/lib/qt4-%type_pkg[qtwebkit]/lib,g; s/-framework /-Wl,-framework,/g;'
	install_name_tool -id "%p/lib/qt4-%type_pkg[qtwebkit]/lib/QtWebKit.framework/Versions/4/QtWebKit" "%i/lib/qt4-%type_pkg[qtwebkit]/lib/QtWebKit.framework/Versions/4/QtWebKit"
	for file in "%i/lib/qt4-%type_pkg[qtwebkit]/imports/QtWebKit"/*.bundle; do
		install_name_tool -change "../lib/QtWebKit.framework/Versions/4/QtWebKit" "%p/lib/qt4-%type_pkg[qtwebkit]/lib/QtWebKit.framework/Versions/4/QtWebKit" "$file"
	done
<<
SplitOff: <<
	Package: %N-shlibs
	Description: Shared libraries for QtWebKit
	Depends: 
	Replaces: <<
		qt4-%type_pkg[qtwebkit]-gui-shlibs (<< 4.7.3-1),
		qt4-%type_pkg[qtwebkit] (<< 4.7.3-1)
	<<
	Files: <<
		lib/qt4-%type_pkg[qtwebkit]/lib/QtWebKit.framework/Versions/4/QtWebKit
		lib/qt4-%type_pkg[qtwebkit]/lib/QtWebKit.framework/Versions/Current
		lib/qt4-%type_pkg[qtwebkit]/lib/QtWebKit.framework/QtWebKit
		lib/qt4-%type_pkg[qtwebkit]/imports
	<<
	Shlibs: %p/lib/qt4-%type_pkg[qtwebkit]/lib/QtWebKit.framework/Versions/4/QtWebKit 4.7.0 %n (>= 2.0.0-1)
<<

DescDetail: <<
QtWebKit provides a Web browser engine that makes it easy to
embed content from the World Wide Web into your Qt application.
<<
<<

